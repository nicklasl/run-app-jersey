<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>Garmin Communicator - Hello Device</title>
<style type="text/css" media="all">
@import "communicator-api/garmin/device/style/communicator.css";
</style>
<script
	src="http://maps.google.com/maps?file=api&v=2.x&key=ABQIAAAAkOp4960CVjgwg7aH_RVbsBRx8XQQBS7xHJZeF9Ardr7B9wB3FxQLA2vT2m8bhaXkBrcrYKlrWsZJMw"
	type="text/javascript">
	<script type="text/javascript" src="communicator-api/prototype/prototype.js"></script>
<script type="text/javascript"
	src="communicator-api/prototype/prototype.js">&#160;</script>
<script type="text/javascript"
	src="communicator-api/garmin/device/GarminDeviceDisplay.js"></script>
<script type="text/javascript">
    var control;
    //create a call-back listener class
    var listener = Class.create();
    listener.prototype = { 
        initialize: function() { },
        onFinishFindDevices: function(json) { 
            var devices = json.controller.getDevices();
            console.log(devices);
            var str = "<b>Devices Found: "+devices.length+"</b><ol>";
            if (json.controller.numDevices > 0) {
                for( var i=0; i < devices.length; i++ ) {
                    str += "<li>"+devices[i].getDisplayName()+"</li>";
                }
                str += "</ol>";
                $('devices').innerHTML = str;
            }
        }
    }

    function load() {
        try {
            control = new Garmin.DeviceControl();
            control.register(new listener());
            var unlocked = control.unlock();
            $('msg').innerHTML = "<h2>Found Plugin, unlocked="+unlocked+"</h2>";
        } catch(e) { alert(e); }
    }

    function findDevices() {
        try {
            control.findDevices();
        } catch(e) { alert(e); }
    }
</script>
<body onload="load()">
	<h1>Auto Load Plugin</h1>
	<div id="msg"></div>
	<div id="devices"></div>
	<input type="button" value="Find Devices" onclick="findDevices()">
	<object id="GarminActiveXControl"
		style="WIDTH: 0px; HEIGHT: 0px; visible: hidden" height="0" width="0"
		classid="CLSID:099B5A62-DE20-48C6-BF9E-290A9D1D8CB5">
		<object id="GarminNetscapePlugin"
			type="application/vnd-garmin.mygarmin" width="0" height="0">
		</object>
	</object>
</body>
</html>